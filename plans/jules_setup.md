# Jules Setup Plan

This document outlines the steps for "Jules" (the agent) to get set up quickly and effectively with the `foundation-base` project.

## 1. Objective

To establish a consistent and efficient workflow for the agent to understand, modify, and test the `foundation-base` codebase.

## 2. Environment Setup

The project uses Leiningen for dependency management and testing. However, the standard environment might not have it installed.

### 2.1. Install Leiningen

If `lein` is not available in the path, install it locally:

```bash
curl -O https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein
chmod +x lein
./lein version
```

**Important**:
*   Always use `./lein` if it is in the current directory, or add it to your `PATH`.
*   The `clojure` and `clj` CLI tools are **not available** in this environment. You must use `lein` for all Clojure-related tasks.

### 2.2. Verify Java

Ensure Java is installed (JDK 21 is currently used in the environment):

```bash
java -version
```

### 2.3. Install Dependencies

Run `lein deps` to download all dependencies defined in `project.clj`:

```bash
export PATH=$PATH:$(pwd)
lein deps
```

## 3. Project Overview

### 3.1. Key Documentation

*   **`README.md`**: General project overview.
    *   *Note*: The `README.md` suggests using Docker (`make run-test`). **Do not use Docker**. The agent environment has restricted permissions (e.g., socket access denied), and Docker commands will fail.
*   **`GEMINI.md`**: **CRITICAL**. Contains the comprehensive style guide for Coding, Testing, and Function Design. Always refer to this before writing code.
*   **`plans/action/js_dsl/`**: Documentation for the JS DSL (`std.lang`). Essential if working on transpiled code.

### 3.2. Directory Structure

*   `src/`: Source code.
*   `test/`: Tests.
*   `plans/`: Project plans and documentation.
*   `project.clj`: Leiningen project configuration. Note that this file contains a large number of JVM options (`--add-opens`, etc.) required for the project. `lein` handles these automatically.

## 4. Development Workflow

### 4.1. Running Tests

Use `code.test` framework via `lein`.

**Warning**: The full test suite (`./lein test`) is very large and may time out in the agent environment.

*   **Recommended**: Run tests for specific namespaces related to your changes.

```bash
# Run a specific test namespace (Recommended)
./lein test :only std.lib.collection-test

# Run all tests (May time out)
./lein test
```

### 4.2. Running a REPL

To explore the codebase interactively:

```bash
./lein repl
```

### 4.3. Working with `std.lang` DSL

If modifying JS/Lua/Python code generated by `std.lang`:
1.  Read `plans/action/js_dsl/dsl_workflow_js.md`.
2.  Follow the specific translation rules (e.g., use `{:key val}` for props, `(:.. props)` for spread).
3.  Use `l/script` blocks for platform-specific code.

## 5. Directives for Jules

1.  **Always Verify**: After creating or modifying files, check the content.
2.  **Run Tests**: Run relevant tests after changes.
3.  **Follow Style**: Adhere strictly to `GEMINI.md`.
4.  **Use Plans**: Update or create plans in `plans/` when undertaking significant tasks.

## 6. Common Issues

*   **Docker Permission Denied**: You may encounter "permission denied" errors when trying to access `/var/run/docker.sock`. This is expected. Do not attempt to fix Docker permissions; use `lein` directly.
*   **`clojure`/`clj` Not Found**: These commands are missing. Use `lein`.
*   **Test Timeouts**: If tests time out, verify you are not running the entire suite unnecessarily. Use `:only` to target specific tests.

## 7. Next Steps

Once setup is complete:
1.  Explore `src/std/lib/` to understand utility functions.
2.  Check `test/` for examples of how to write tests.
3.  Start with a small task or bug fix to familiarize with the workflow.
